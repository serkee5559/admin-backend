<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/defaultLayout}">

<div layout:fragment="content">
  <div class="bg-white p-8 rounded-xl shadow-md">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-gray-800">인사 관리</h1>
      <button onclick="openModal('create')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition flex items-center gap-2">
        <i data-lucide="plus-circle" class="w-5 h-5"></i> 새 회원 등록
      </button>
    </div>

    <table class="w-full text-left border-collapse">
      <thead>
      <tr class="bg-gray-100 border-b">
        <th class="py-3 px-4 text-gray-600 font-semibold">ID</th>
        <th class="py-3 px-4 text-gray-600 font-semibold">이름</th>
        <th class="py-3 px-4 text-gray-600 font-semibold">이메일</th>
        <th class="py-3 px-4 text-gray-600 font-semibold">부서</th>
        <th class="py-3 px-4 text-gray-600 font-semibold">관리</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="member : ${members}" class="border-b hover:bg-gray-50 transition">
        <td class="py-3 px-4" th:text="${member.id}">1</td>
        <td class="py-3 px-4 font-medium" th:text="${member.name}">이름</td>
        <td class="py-3 px-4 text-gray-500" th:text="${member.email}">이메일</td>
        <td class="py-3 px-4 text-gray-500" th:text="${member.department}">부서</td>
        <td class="py-3 px-4 flex gap-3">
          <button th:onclick="openModal('edit', [[${member}]])" class="text-blue-500 hover:underline flex items-center gap-1">
            <i data-lucide="pencil" class="w-4 h-4"></i> 수정
          </button>

          <form th:action="@{/members/delete/{id}(id=${member.id})}" method="post" class="inline">
            <button type="submit" class="text-red-500 hover:underline flex items-center gap-1" onclick="return confirm('정말 삭제할까요?')">
              <i data-lucide="trash-2" class="w-4 h-4"></i> 삭제
            </button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div id="memberModal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all scale-95 duration-300">
      <div class="p-6 border-b flex justify-between items-center bg-gray-50 rounded-t-2xl">
        <h2 id="modalTitle" class="text-xl font-bold text-gray-800">회원 등록</h2>
        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
          <i data-lucide="x" class="w-6 h-6"></i>
        </button>
      </div>

      <form id="memberForm" method="post" class="p-6 space-y-4">
        <div id="idField" class="hidden">
          <label class="block text-sm font-medium text-gray-500 mb-1">회원 번호 (ID)</label>
          <input type="text" id="m_id" name="id" readonly class="w-full px-4 py-2 bg-gray-100 border border-gray-200 rounded-lg text-gray-400 outline-none">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">이름</label>
          <input type="text" id="m_name" name="name" required placeholder="이름을 입력하세요"
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">이메일</label>
          <input type="email" id="m_email" name="email" placeholder="test@example.com"
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">부서</label>
          <input type="text" id="m_department" name="department" placeholder="인사팀"
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
        </div>

        <div class="flex gap-3 pt-4">
          <button type="submit" class="flex-1 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition shadow-lg shadow-blue-200">저장하기</button>
          <button type="button" onclick="closeModal()" class="flex-1 bg-gray-100 text-gray-700 font-bold py-3 rounded-lg hover:bg-gray-200 transition">취소</button>
        </div>
      </form>
    </div>
  </div>

  <script th:inline="javascript">
    const modal = document.getElementById('memberModal');
    const form = document.getElementById('memberForm');
    const modalTitle = document.getElementById('modalTitle');

    function openModal(mode, member = null) {
      if (mode === 'edit' && member) {
        modalTitle.innerText = "회원 정보 수정";
        form.action = "/members/edit/" + member.id;

        document.getElementById('m_id').value = member.id;
        document.getElementById('m_name').value = member.name;
        document.getElementById('m_email').value = member.email || '';
        document.getElementById('m_department').value = member.department || '';

        document.getElementById('idField').classList.remove('hidden');
      } else {
        modalTitle.innerText = "새 회원 등록";
        form.action = "/members/new";
        form.reset();
        document.getElementById('idField').classList.add('hidden');
      }

      modal.classList.remove('hidden');
      lucide.createIcons(); // 모달 내 아이콘 렌더링
    }

    function closeModal() {
      modal.classList.add('hidden');
    }

    // 배경 클릭 시 닫기
    window.onclick = function(event) {
      if (event.target == modal) closeModal();
    }
  </script>
</div>
</html>